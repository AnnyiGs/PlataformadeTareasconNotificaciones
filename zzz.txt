kubectl port-forward -n task-platform svc/auth-service 8001:8001

kubectl port-forward -n task-platform svc/task-service 8002:8002

kubectl port-forward -n task-platform svc/notification-service 8003:8003




$userResp = Invoke-RestMethod -Uri "http://localhost:8001/auth/register?email=chambeador2@example.com&password=demo123&role=user" -Method POST
$userResp | Format-List
$userToken = $userResp.access_token
$userId = $userResp.id
Write-Host "âœ… Usuario ID=$userId creado con token: $userToken"

------------------------

$adminResp = Invoke-RestMethod -Uri "http://localhost:8001/auth/register?email=jefote2@example.com&password=admin123&role=admin" -Method POST
$adminResp | Format-List
$adminToken = $adminResp.access_token
$adminId = $adminResp.id
Write-Host "âœ… Admin ID=$adminId creado con token: $adminToken"

--------------------------

Write-Host "`n=== CREANDO TAREA (Admin asigna al Usuario) ===" -ForegroundColor Cyan

$adminHeaders = @{
  "Authorization" = "Bearer $adminToken"
  "Content-Type" = "application/json"
}

# EDITABLE: Cambia el texto entre comillas
$taskBody = '{"title":"Completar demo Kubernetes","description":"Demostrar microservicios con notificaciones","assigned_to":5}'

$taskResp = Invoke-RestMethod -Uri "http://localhost:8002/tasks/" -Method POST -Headers $adminHeaders -Body $taskBody
$taskResp | Format-List

Write-Host "âœ… Tarea ID=$($taskResp.id) creada por Admin ID=$adminId y asignada a Usuario ID=$userId" -ForegroundColor Green

----




â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  COMANDOS QUE FUNCIONAN - DEMO FINAL                     â•‘
â•‘                     (Copiar y pegar directamente)                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


ğŸ“‹ PASO 1: REGISTRAR USUARIO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
DescripciÃ³n: Crea un usuario regular con rol "user" en la plataforma.
Genera un token JWT que se almacena en $userToken.
EDITABLE: email y password

$userResp = Invoke-RestMethod -Uri "http://localhost:8001/auth/register?email=chambeador2@example.com&password=demo123&role=user" -Method POST
$userResp | Format-List
$userToken = $userResp.access_token
$userId = $userResp.id
Write-Host "âœ… Usuario ID=$userId creado con token: $userToken"


ğŸ“‹ PASO 2: REGISTRAR ADMINISTRADOR
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
DescripciÃ³n: Crea un usuario administrador con rol "admin".
Solo admins pueden crear y asignar tareas.
EDITABLE: email y password

$adminResp = Invoke-RestMethod -Uri "http://localhost:8001/auth/register?email=jefote2@example.com&password=admin123&role=admin" -Method POST
$adminResp | Format-List
$adminToken = $adminResp.access_token
$adminId = $adminResp.id
Write-Host "âœ… Admin ID=$adminId creado con token: $adminToken"


ğŸ“‹ PASO 3: CREAR TAREA (Admin asigna al Usuario)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
DescripciÃ³n: Admin crea una nueva tarea y la asigna a un usuario.
AutomÃ¡ticamente genera una notificaciÃ³n para el usuario asignado.
EDITABLE: title, description, assigned_to (cambiar el ID del usuario)

Write-Host "`n=== CREANDO TAREA (Admin asigna al Usuario) ===" -ForegroundColor Cyan

$adminHeaders = @{
  "Authorization" = "Bearer $adminToken"
  "Content-Type" = "application/json"
}

$taskBody = '{"title":"Completar demo Kubernetes","description":"Demostrar microservicios con notificaciones","assigned_to":7}'

$taskResp = Invoke-RestMethod -Uri "http://localhost:8002/tasks/" -Method POST -Headers $adminHeaders -Body $taskBody
$taskResp | Format-List

Write-Host "âœ… Tarea ID=$($taskResp.id) creada por Admin ID=$adminId y asignada a Usuario ID=7" -ForegroundColor Green


ğŸ“‹ PASO 4: USUARIO VE SUS TAREAS ASIGNADAS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
DescripciÃ³n: El usuario visualiza SOLO sus tareas asignadas.
Demuestra AISLAMIENTO: No puede ver tareas de otros usuarios.
Usa: $userToken (del PASO 1)

Write-Host "`n=== USUARIO VE SUS TAREAS ASIGNADAS ===" -ForegroundColor Cyan

$userHeaders = @{
  "Authorization" = "Bearer $userToken"
  "Content-Type" = "application/json"
}

$tasksResp = Invoke-RestMethod -Uri "http://localhost:8002/tasks/assigned" -Method GET -Headers $userHeaders
$tasksResp | Format-Table -AutoSize

Write-Host "âœ… Usuario ID=$userId ve solo sus tareas asignadas" -ForegroundColor Green
Write-Host "âœ… USER ISOLATION: No puede ver tareas de otros usuarios" -ForegroundColor Yellow


ğŸ“‹ PASO 5: VER NOTIFICACIONES AUTOMÃTICAS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
DescripciÃ³n: Muestra las notificaciones generadas automÃ¡ticamente.
Se crean cuando admin asigna una tarea al usuario.
Usa: $userToken (del PASO 1)

Write-Host "`n=== NOTIFICACIONES AUTOMÃTICAS ===" -ForegroundColor Cyan

$notifResp = Invoke-RestMethod -Uri "http://localhost:8003/notifications" -Method GET -Headers $userHeaders
$notifResp | Format-Table -AutoSize

Write-Host "âœ… NotificaciÃ³n generada automÃ¡ticamente al crear la tarea" -ForegroundColor Green
Write-Host "ğŸ”” Sistema automÃ¡tico: Se notificÃ³ al usuario cuando se asignÃ³ la tarea" -ForegroundColor Yellow


ğŸ“‹ PASO 6: PRUEBA DE SEGURIDAD (Usuario NO puede crear tareas)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
DescripciÃ³n: Demuestra RBAC: Usuario intenta crear tarea y es rechazado.
Solo ADMIN tiene permiso para crear tareas.
Usa: $userToken (del PASO 1)

Write-Host "`n=== PRUEBA DE SEGURIDAD: Usuario intenta crear tarea ===" -ForegroundColor Red

$taskBody = '{"title":"Tarea no autorizada","description":"El usuario intenta crear una tarea","assigned_to":7}'

try {
  $taskResp = Invoke-RestMethod -Uri "http://localhost:8002/tasks/" -Method POST -Headers $userHeaders -Body $taskBody
  Write-Host "âŒ ERROR: El usuario pudo crear la tarea (deberÃ­a fallar)" -ForegroundColor Red
} catch {
  $statusCode = $_.Exception.Response.StatusCode.Value__
  Write-Host "âœ… SEGURIDAD VALIDADA: Usuario rechazado con HTTP $statusCode" -ForegroundColor Green
  Write-Host "âœ… RBAC FUNCIONANDO: Solo Admin puede crear tareas" -ForegroundColor Green
}


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

RESUMEN DE VARIABLES A TENER EN CUENTA:
  $userToken   â†’ Token JWT del usuario (PASO 1)
  $userId      â†’ ID del usuario (PASO 1)
  $adminToken  â†’ Token JWT del admin (PASO 2)
  $adminId     â†’ ID del admin (PASO 2)
  $userHeaders â†’ Headers con autenticaciÃ³n del usuario
  $adminHeaders â†’ Headers con autenticaciÃ³n del admin

NOTA: Ejecuta PASO 1 y PASO 2 primero para obtener tokens y IDs.
Luego ejecuta PASO 3, 4, 5, 6 en orden.
